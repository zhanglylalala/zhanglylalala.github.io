<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://http://www.laughingtree.cn').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="LaughingTree">
<meta property="og:url" content="http://http//www.laughingtree.cn/page/3/index.html">
<meta property="og:site_name" content="LaughingTree">
<meta property="article:author" content="LiyunZhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://http//www.laughingtree.cn/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>LaughingTree</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LaughingTree</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">33</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/21/06-Locality-Communication-and-Contention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/21/06-Locality-Communication-and-Contention/" class="post-title-link" itemprop="url">06. Locality, Communication, and Contention</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-21 13:42:23" itemprop="dateCreated datePublished" datetime="2022-05-21T13:42:23+08:00">2022-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-06-11 21:43:56" itemprop="dateModified" datetime="2022-06-11T21:43:56+08:00">2022-06-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97-CMU-15-418-Stanford-CS149/" itemprop="url" rel="index">
                    <span itemprop="name">并行计算 (CMU 15-418 / Stanford CS149)</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Communication"><a href="#Communication" class="headerlink" title="Communication"></a>Communication</h1><h2 id="Reduce-communication-time"><a href="#Reduce-communication-time" class="headerlink" title="Reduce communication time"></a>Reduce communication time</h2><ol>
<li><p>Total communication time = overhead + occupancy + network delay. </p>
</li>
<li><p>Overhead is the time spent on the communication by a processor, occupancy is the time for data to pass through slowest component of system, and network delay is everything else. </p>
</li>
<li><p>Reduce overhead of communication to sender/receiver:<br>Reassign tasks in a better way that need to send fewer messages.<br>Make messages larger to amortize overhead.<br>Coalesce many small messages into large ones</p>
</li>
<li><p>Reduce delay:<br>Application writer can restructure code to exploit locality.<br>Hardware implementor can improve communication architecture. </p>
</li>
</ol>
<h2 id="Reduce-communication-cost"><a href="#Reduce-communication-cost" class="headerlink" title="Reduce communication cost"></a>Reduce communication cost</h2><ol>
<li><p>Total communication cost = communication time - overlap</p>
</li>
<li><p>Overlap: portion of communication performed concurrently with other work (“other work” can be computation or other communication)</p>
</li>
<li><p>Cost is the part that your cannot get over with by changing the protocol. The communication time is obviously necessary, and we can hide the overlap part by pipelining. </p>
</li>
<li><p>Increase communication/computation overlap:<br>Application writer can use asynchronous communication (e.g., async messages)<br>Hardware implementor can use pipelining, multi-threading, pre-fetching, out-of-order execution<br>Requires additional concurrency in application (more concurrency than number of execution units)</p>
</li>
<li><p>Instruction pipeline: Break execution of each instruction down into several smaller steps.<br>Enables higher clock frequency, only a simple, short operation is done by each part of pipeline each clock</p>
</li>
<li><p>Non-piplined communication: $T(n)=T_0+\frac{n}{B}$ ($T_0$ is the start-up latency, n is bytes transferred in operation, B is transfer rate or bandwidth)<br>Efficient bandwidth $=\frac{n}{T(n)}$</p>
</li>
</ol>
<h2 id="Improve-arithmetic-intensity"><a href="#Improve-arithmetic-intensity" class="headerlink" title="Improve arithmetic intensity"></a>Improve arithmetic intensity</h2><ol>
<li><p>Communication-to-computation ratio = amount of communication  / amount of computation<br>The units can be different. If the denominator is the execution time of computation, the ratio gives the average bandwidth requirement</p>
</li>
<li><p>Arithmetic intensity = 1 / communication-to-computation ratio</p>
</li>
<li><p>Change the traversal order to reduce the time between accesses to same data. We want to do all the calculations related to the accessing data now.<br>This way can improve the utilization of cache by preventing that those data get flushed out when we try to access them again. </p>
</li>
<li><p>Fuse loops to reduce the frequency of store operation. </p>
</li>
<li><p>Improve arithmetic intensity by sharing data. Co-locate tasks that operate on the same data.  Schedule threads working on the same data structure at the same time on the same processor. Reduces inherent communication</p>
</li>
</ol>
<h2 id="Reduce-artifactual-communication"><a href="#Reduce-artifactual-communication" class="headerlink" title="Reduce artifactual communication"></a>Reduce artifactual communication</h2><ol>
<li><p>Inherent communication: Communication that must occur in a parallel algorithm. The communication is fundamental to the algorithm.<br>Artifactual communication: all other communication that happens because we want to efficiently use resource.</p>
</li>
<li><p>Granularity of communication can be important because it may introduce artifactual communication.<br>Assume that communication granularity is a cache line. </p>
</li>
<li><p>If we see data as row-major layout, when the data required is in column, each communication actually only provides one needed data. </p>
</li>
<li><p>When Threads access their assigned elements (no inherent communication exists), real machine triggers (artifactual) communication due to the cache line being written to by both processors. </p>
</li>
<li><p>Reducing artifactual comm by blocked data layout. Each communication only involves  the data in the same block. If communication granularity is larger than a block row, each communication will transfer multiple rows. </p>
</li>
</ol>
<h1 id="Contention"><a href="#Contention" class="headerlink" title="Contention"></a>Contention</h1><ol>
<li><p>Contention occurs when many requests to a resource are made within a small window of time. The resource is a hot spot.<br>Contention for shared resource results in longer overall operation times. </p>
</li>
<li><p>Distributed work queues serve to reduce contention (contention in access to single shared work queue)</p>
</li>
<li><p>One way to reduce contention is to use finer-granularity locks. Instead of locking the whole data structure, we can only lock a part of that structure. </p>
</li>
<li><p>Another way is that each CUDA block computes partial results and merges them afterwards. But this requires extra work for merging, and each CUDA block need to store a partial result instead of all of them using the same result. </p>
</li>
<li><p>The best way is to stagger access to contended resources. For example, instead of calculate the final result directly, we can calculate several temporal results which has no contention, and get the final result from them. </p>
</li>
</ol>
<h1 id="Understanding-the-performance"><a href="#Understanding-the-performance" class="headerlink" title="Understanding the performance"></a>Understanding the performance</h1><ol>
<li><p>Always, always, always try the simplest parallel solution first, then measure performance to see where you stand. </p>
</li>
<li><p>We should compare parallel program speedup to the best sequential program, instead of parallel algorithm running on one core.<br>The reason is that to allow for parallelism, we might change the algorithm, and make it slower when executed sequentially. </p>
</li>
<li><p>Determine if your performance is limited by computation, memory bandwidth (or memory latency), or synchronization?<br>Try and establish “high watermarks”. What’s the best you can do in practice? How close is your implementation to a best-case scenario?</p>
</li>
<li><p>Roofline model: Use microbenchmarks to compute peak performance of a machine as a function of arithmetic intensity of application. Then compare application’s performance to known peak values</p>
</li>
</ol>
<h2 id="Establish-high-watermarks"><a href="#Establish-high-watermarks" class="headerlink" title="Establish high watermarks"></a>Establish high watermarks</h2><ol>
<li><p>Add “math” (non-memory instructions).<br>Does execution time increase linearly with operation count as math is added?<br>If so, this is evidence that code is instruction-rate limited</p>
</li>
<li><p>Remove almost all math, but load same data.<br>How much does execution-time decrease?<br>If not much, suspect memory bottleneck</p>
</li>
<li><p>Change all array accesses to A[0].<br>How much faster does your code get?<br>This establishes an upper bound on benefit of improving locality of data access</p>
</li>
<li><p>Remove all atomic operations or locks.<br>How much faster does your code get? (provided it still does approximately the same amount of work)<br>This establishes an upper bound on benefit of reducing sync overhead. </p>
</li>
</ol>
<h2 id="Scaling"><a href="#Scaling" class="headerlink" title="Scaling"></a>Scaling</h2><ol>
<li><p>Arithmetic intensity is determined by both problem size and the processors number. Small problem size or large processor number both yields low arithmetic intensity. </p>
</li>
<li><p>If the problem size is too small, it might already execute fast enough on a single core. Scaling the performance of small problem ay not be all that important. </p>
</li>
<li><p>If the problem size is too large for a single machine, working set may not fit in memory, and causing thrashing to disk. With enough processors, the key working set fits in per-processor cache.<br>This may get a super-linear speedup and make speedup on a bigger parallel machine with more memory look amazing. </p>
</li>
<li><p>Desire to scale problem size as machine sizes grow (buy a bigger machine to compute more, rather than just compute the same problem faster)</p>
</li>
<li><p>Problem-constrained scaling focuses on using a parallel computer to solve the same problem faster<br>$Speedup=\frac{time 1 processor}{time P processors}$</p>
</li>
<li><p>Time-constrained scaling focuses on completing more work in a fixed amount of time<br>$Speedup = \frac{work done by P processors}{work done by 1 processor}$<br>“Work done” may not be linear function of problem inputs. One approach of defining “work done” is by execution time of same computation on a single processor (but consider effects of thrashing if problem too big)</p>
</li>
<li><p>Memory-constrained scaling (wak scaling) focuses on running the largest problem possible without overflowing main memory. Neither work or execution times are held constant.<br>$Speedup = \frac{work (P processors)}{time (P processors)}/\frac{work (1 processor)}{time (1 processor)}=\frac{work per unit time on P processors}{work per unit time on 1 processor}$</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/19/05-Graphic-processing-units-and-CUDA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/19/05-Graphic-processing-units-and-CUDA/" class="post-title-link" itemprop="url">05. Graphic processing units and CUDA</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-19 09:59:09" itemprop="dateCreated datePublished" datetime="2022-05-19T09:59:09+08:00">2022-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-22 17:22:04" itemprop="dateModified" datetime="2022-05-22T17:22:04+08:00">2022-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97-CMU-15-418-Stanford-CS149/" itemprop="url" rel="index">
                    <span itemprop="name">并行计算 (CMU 15-418 / Stanford CS149)</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Graphics"><a href="#Graphics" class="headerlink" title="Graphics"></a>Graphics</h1><ol>
<li>The first step to draw a graphic in screen is to describe the things (key entities) that are manipulated, whose surface is represented as a 3D triangle mesh.<br>So the input of the calculating system is a list of vertices in 3D space and their connectivity into primitives. </li>
<li>The operations of system is as following:<br>Given a scene camera position, compute where the vertices lie on screen<br>Group vertices into primitives<br>Generate one fragment for each pixel a primitive overlaps<br>Compute color of primitive for each fragment based on scene lighting and primitive material properties<br>Put color of the “closest fragment” to the camera in the output image</li>
<li>We can Abstract process of rendering a picture as a sequence of operations on vertices, primitives, fragments, and pixels.<br>GPUs are very fast processors for performing the same computation (shader programs) on large collections of data (streams of vertices, fragments, and pixels), which sounds like data-parallelism. </li>
<li>To do GPU-based scientific computation, we need to set OpenGL output image size to be output array size, and render 2 triangles that exactly cover screen. </li>
</ol>
<h1 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h1><h2 id="Grid-Block-and-Thread"><a href="#Grid-Block-and-Thread" class="headerlink" title="Grid, Block and Thread"></a>Grid, Block and Thread</h2><ol>
<li><p>CUDA thread IDs can be up to 3-dimensional. Multiple threads make up a block, and multiple blocks make up a grid.<br>Each kernel has a grid. All the the blocks in a grid form a 3D matrix, and all the threads in a block also form a 3D matrix.<br>We can get information about the shape of threads in a block matrix or block in a grid matrix in a block with <code>block_dim</code> and <code>grid_dim</code></p>
</li>
<li><p>When launching the CUDA threads, we need to specify the size of blocks and threads with <code>kernel_function&lt;&lt;&lt;block_dim, thread_dim&gt;&gt;&gt;(parameters)</code>.<br>Here <code>block_dim</code> and <code>thread_dim</code> can be either a <code>dim3</code> value or a number of the total number of blocks and threads per-block to make the CUDA compiler figure out how to arrange blocks and threads.</p>
</li>
<li><p>So the coordinate to declare or locate a block in a grid, or a thread in a block is 3D. In the CUDA code, we can get the information about current block or thread with <code>blockIdx</code>, <code>threadIdx</code>, and their properties <code>x</code>, <code>y</code>, <code>z</code>. </p>
</li>
<li><p>The calculation object of CUDA is usually matrices. So we would prefer to cut matrices into blocks. Each CUDA block calculate one  block in matrices, and each thread calculate one element in matrices. </p>
</li>
<li><p>In <code>pthread</code>, there is stack space for thread, and need to allocate control block so OS can schedule thread.<br>Unlike <code>pthread</code>, CUDA control those instances by thread blocks. If control by threads, there will be too many to control.</p>
</li>
<li><p>Major CUDA assumption: thread block execution can be carried out in any order (no dependencies between blocks)</p>
</li>
</ol>
<h2 id="Kernel-function"><a href="#Kernel-function" class="headerlink" title="Kernel function"></a>Kernel function</h2><ol>
<li><p>“Host” code: serial execution runs as part of normal C/C++ application on CPU<br>“CUDA device” code: a kernel function runs on GPU, which is denoted by <code>__global__</code> before the definition of the kernel function.<br>Device function: SPMD execution on GPU, which is denoted by <code>__device__</code>. These functions are called by kernels, and don’t generate new threads.<br>Kernels and device functions only reference device memory. Host code can only reference host memory, but can have pointers to device memory. </p>
</li>
<li><p>In kernel function, we need to get the indices of the element a thread calculating. For a 2D matrix, we usually take <code>x</code> as column direction, and <code>y</code> as row direction.<br>So to access <code>A[i][j]</code>, <code>i = blockIdx.y * blockDim * y + threadIdx.y</code> and <code>j = blockIdx.x * blockDim.x + threadIdx.x</code>.</p>
</li>
<li><p>Number of kernel invocations is not determined by size of data collection. So normally we want to do a test before accessing the vector values (array values). The overhead of the test can be ignored, although it does cause some threads are not used. </p>
</li>
<li><p><code>__syncthreads()</code> is a barrier that wait for all threads in the block to arrive at this point.<br>Atomic operations on both global memory and shared memory variables is also provided, but they are very expensive, should only be used as the last resort.<br>There is an implicit barrier across all threads at return of kernel. </p>
</li>
<li><p>A compiled CUDA device binary includes program text (instructions) and information about required resources (how many threads per block, how much space per thread, how much shared space per thread block) </p>
</li>
</ol>
<h2 id="Memory-Model"><a href="#Memory-Model" class="headerlink" title="Memory Model"></a>Memory Model</h2><ol>
<li><p>Host and device have distinct address spaces, so before the execution, we need to copy data into CUDA memory.<br><code>cudaMalloc(ptr, size)</code> can be used to allocate CUDA memory, and <code>cudaFree(ptr)</code> can free CUDA memory. The pointer in <code>cudaMalloc</code> can just be a host variable, but the pointer in <code>cudaFree</code> must be allocated by <code>cudaMalloc</code>.<br><code>cudaMemcpy(dest, src, size, kind)</code> can copy those data into CUDA memory. <code>kind</code> is the direction of copy, which can be <code>cudaMemcpyHostToDevice</code> or <code>curdaMemcpyDeviceToHost</code>. </p>
</li>
<li><p>There are three distinct types of memory visible to kernels, per-thread private memory, per-block shared memory, and device global memory. </p>
</li>
<li><p><code>cudaMalloc</code>, <code>cudaMemcpy</code> and <code>cudaFree</code> all operate on device global memory, and those local variables in kernel function are in perthread private memory.<br>We can declare variables in per-block shared memory with <code>__share__</code>. </p>
</li>
<li><p>If multiple threads in a block need to access a common memory, they will all read that memory once. And if that memory is in the global memory, it would be really slow. </p>
</li>
<li><p>To avoid such efficient decrease, we can copy the common memory into the per-block shared memory. So we only need to access global memory once, and later accesses only in per-block shared memory.<br>We just need to declare a <code>__share__</code> array, and assign it with values in global memory. </p>
</li>
<li><p>All threads copy data from global memory to per-block shared memory asynchronous, so we better ass a <code>_syncthread()</code> to  make sure later operations only start when all data have been copied. </p>
</li>
</ol>
<h2 id="Hardware-implementation"><a href="#Hardware-implementation" class="headerlink" title="Hardware implementation"></a>Hardware implementation</h2><ol>
<li><p>Those synchronization within a warp and scheduling are done by hardware, and programmers don’t need to worry about these things.</p>
</li>
<li><p>GPU implementation maps thread blocks (“work”) to cores using a dynamic scheduling policy that respects resource requirements. </p>
</li>
<li><p>In GPU implementation (not a CUDA abstraction), each SM has multiple groups of warps. However, the number of warp execution contexts is far more than the number of warps.<br>And there is a warp selector for each warp to choose the instruction to be executed by that warp. Each warp selector usually has two (or more) Fectch/Decoder unit. </p>
</li>
<li><p>Shared per-block memory and L1-cache are inside each SM, but L2-cache is shared by all SMs.<br>The devide global memory (GPU memory) only communicates with blocks through L2-cache. </p>
</li>
<li><p>Each clock, an SM will choose several warp contexts to fill all warps to use thread-level pallelism, and a warp will choose several instructions to fill all Fetch/Decoder units to use instruction-level pallelism. </p>
</li>
<li><p>When running a CUDA program, GPU work schedulor will map one block to multiple warps in the same SM core. CUDA threads numbered within block in row-major order.<br>Inside a single thread block is SPMD shared address space programming. </p>
</li>
<li><p>When single warp accesses consecutive memory locations, do block read or write. When single warp accesses separated memory locations, requires gather (read) or scatter(write)</p>
</li>
<li><p>One SM core may have multiple blocks, so a SMM core is capable of concurrently executing multiple CUDA thread blocks.<br>When all threads in block complete, block resources (shared memory allocations, warp execution contexts) become available for next block. </p>
</li>
<li><p>The CUDA program is not compiled to SIMD instructions like ISPC gangs. GPU hardware is dynamically checking whether 32 independent CUDA threads share an instruction, and if this is true, it executes all 32 threads in a SIMD manner, or performance can suer due to divergent execution. </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/17/04-Work-Distribution-and-Scheduling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/17/04-Work-Distribution-and-Scheduling/" class="post-title-link" itemprop="url">04. Work Distribution and Scheduling</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-17 15:35:33" itemprop="dateCreated datePublished" datetime="2022-05-17T15:35:33+08:00">2022-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-18 17:07:58" itemprop="dateModified" datetime="2022-05-18T17:07:58+08:00">2022-05-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97-CMU-15-418-Stanford-CS149/" itemprop="url" rel="index">
                    <span itemprop="name">并行计算 (CMU 15-418 / Stanford CS149)</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Balancing-the-workload"><a href="#Balancing-the-workload" class="headerlink" title="Balancing the workload"></a>Balancing the workload</h1><p>Always implement the simplest solution first, then measure performance to determine if you need to do better. </p>
<h2 id="Static-assignment"><a href="#Static-assignment" class="headerlink" title="Static assignment"></a>Static assignment</h2><ol>
<li>The assignment of work to threads is pre-determined. But not necessarily determined at compile-time, may depend on runtime parameters. </li>
<li>Benefit: simple, essentially zero runtime overhead</li>
<li>Applicable situation: When the cost (execution time) of work and the amount of work is predictable. The followings are some most common situations:<br>When it is known up front that all work has the same cost<br>When work is predictable, but not all jobs have same cost<br>When statistics about execution time are known</li>
<li>Semi-static assignment: When the cost of work is predictable for near-term future, we can periodically profile itself and re-adjust assignment.<br>Assignment is “static” for the interval between re-adjustments</li>
</ol>
<h2 id="Dynamic-assignment"><a href="#Dynamic-assignment" class="headerlink" title="Dynamic assignment"></a>Dynamic assignment</h2><ol>
<li><p>Program determines assignment dynamically at runtime to ensure a well distributed load. Often used when the execution time of tasks, or the total number of tasks, is unpredictable. </p>
</li>
<li><p>The ISPC task is implemented dynamically. </p>
</li>
</ol>
<h3 id="With-one-queue"><a href="#With-one-queue" class="headerlink" title="With one queue"></a>With one queue</h3><ol>
<li><p>The programmers divide the whole problem into sub-problems (or “tasks”, “work”). A queue shared by all threads is a collection of work to do. Whenever a thread finished its task, it will grab another task from the queue. </p>
</li>
<li><p>Fine granularity partitioning: each task is small.<br>This is likely to have a good workload balance, but potential for high synchronization cost. </p>
</li>
<li><p>Coarse granularity partitioning: each task is larger.<br>This will decrease synchronization cost and the overhead, but may have a worse workload balance. </p>
</li>
<li><p>Long tasks should be scheduled first. Thread performing long task performs fewer overall tasks, but approximately the same amount of work as the other threads. This requires some knowledge of workload. </p>
</li>
</ol>
<h3 id="With-a-set-of-queues"><a href="#With-a-set-of-queues" class="headerlink" title="With a set of queues"></a>With a set of queues</h3><ol>
<li><p>When assign with one queue, all threads have to communicate with each other about the queue. </p>
</li>
<li><p>Each thread has their own queue, and they only execute tasks in their queue. So there is no need to communication with other threads. </p>
</li>
<li><p>At the beginning, the programmer push tasks into queues arbitarily (a bit like static assignment).<br>The dynamic is that when a queue is empty, that thread can steal from other threads that is  still working.<br>It will steal from a random thread. Every time, it will steal a proportion of the tasks in the target queue, not all of them, and usually more than one task.<br>A thread is terminated when there is no thread for it to steal, namely when a steal is failed, it will try to steal from other threads, util it have tried all of them. </p>
</li>
<li><p>Stealing involves communication, but in a lower frequency then one queue method. And in this way, the local queue access is fast. </p>
</li>
<li><p>Sometimes it is hard to have fully independent task, but work in task queues need not be independent.<br>A task is not removed from queue and assigned to worker thread until all task dependencies are satisfied. Workers can submit new tasks (with optional explicit dependencies) to task system</p>
</li>
</ol>
<h1 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h1><p>In a divide-and-conquer algorithm, there is both dependencies and independencies. Like in quick-sort, both the divide is dependent on the partition, and those two divide is independent.<br>With Cilk Plus, we can express divide-and-conquer easier. </p>
<h2 id="cilk-spawn"><a href="#cilk-spawn" class="headerlink" title="cilk_spawn"></a>cilk_spawn</h2><ol>
<li><p><code>cilk_spawn</code> is labelled before a function call, so that the called function can run with the code after the call concurrently.<br>The call labelled <code>cilk_spawn</code> is the spawned child, and the rest of the code is the continuation.</p>
</li>
<li><p>In divide-and-conquer, there is always a time, when the problem size is small enough that overhead of spawn trumps benefits of<br>potential parallelization. And then we will solve those problems sequentially. </p>
</li>
<li><p>The main idea is to expose independent work (potential parallelism) to the system using <code>cilk_spawn</code>. </p>
</li>
<li><p><code>cilk_spawn</code> is a bit like <code>pthread_create</code>, and <code>cilk_sync</code> is similar to <code>pthread_join</code>. But <code>pthread</code> has some problems when too many threads are spawned.<br>The first is the heavyweight spawn operation. And many more concurrently running threads than cores, which will cause context switching overhead and larger working set than necessary, less cache locality. </p>
</li>
<li><p>The Cilk Plus runtime maintains pool of worker threads. All threads created at application launch.  There are exactly as many worker threads as execution contexts in the machine.<br>If we labelled everything <code>cilk_spawn</code>, the main thread has nothing to do. </p>
</li>
<li><p>Each thread in the pool will maintain a work queue to store what word needs to be done.<br>When a thread goes idle, it will look in busy thread’s queue for work, and moves work from busy thread’s queue to its own queue.</p>
</li>
<li><p>If caller thread runs the continuation first, the queue should record the child for later execution, and child is made available for stealing by other threads.<br>In this method, caller thread will spawn as many child as it could, like BFS. If no stealing, execution order is very different than<br>that of program withcilk_spawnremoved. </p>
</li>
<li><p>If caller thread runs the child first, the queue should record continuation for later execution, and continuation is made available for stealing by other threads.<br>In this method, caller thread will only create one item to steal.<br>If no stealing occurs, thread continually pops continuation from work queue, enqueues new continuation (like DFS). The order of execution is the same as for program with spawn removed.<br>If continuation is stolen, stealing thread spawns next child. </p>
</li>
<li><p>If the continuation is run first, there will be more items to steal, and thus makes a better advantage of multi-thread.<br>But if the continuation is run first, the work queue storage for system with T threads is no more than T times that of stack storage for single threaded execution, and thus saves more space. </p>
</li>
<li><p>Work queue is implemented as a dequeue (double ended queue).<br>Local thread pushes/pops from the “tail” (bottom), while remote threads steal from “head” (top).<br>Reduces contention with local thread: local thread is not accessing same part of dequeue that stealing threads do.<br>Do larger work first: in divide-and-conquer, the top of the queue is usually at the beginning of call tree, and is a larger piece of work.<br>Maximizes locality: in conjunction with run-child-first policy, local thread works on local part of call tree</p>
</li>
</ol>
<h2 id="cilk-sync"><a href="#cilk-sync" class="headerlink" title="cilk_sync"></a>cilk_sync</h2><ol>
<li><p><code>cilk_sync</code> is used after those <code>cilk_spawn</code> call code. It will return when all calls spawned by current function have completed. </p>
</li>
<li><p>There is an implicitcilk_syncat the end of every function that contains a cilk_spawn, so when a Cilk function returns, all work associated with that function is complete. </p>
</li>
<li><p>If no work has been stolen by other threads, then there’s nothing to do at the sync point, <code>cilk_sync</code> is a no-op. But this is not a common situation. </p>
</li>
<li><p>One way to implement sync is with stalling joint.<br>Thread that initiates the fork must perform the sync. Therefore it waits for all spawned work to be complete.<br>descriptor for block A created<br>When a stealing from the initial thread happens, a descriptor for that stolen work is created to track the number of outstanding spawns for the block, and the number of those spawns that have completed.<br>When all the child spowned for the block is done, this block is considered done, and the descriptor is free. When all the blocks are done, sync is fullfilled. </p>
</li>
<li><p>Another way to implement sync is the greedy policy.<br>When thread that initiates the fork goes idle, it can look to steal new work.  Last thread to reach the join point continues execution after sync. This will also create a decriptor for those stolen work.<br>Worker thread that initiated spawn may not be thread that executes logic after <code>cilk_sync</code>. </p>
</li>
<li><p>In greedy policy, All threads always attempt to steal if there is nothing to do, and thread only goes idle if no work to steal is present in system. But in stalling policy, the initial thread doesn’t steal, and only waits when its work is done. </p>
</li>
<li><p>Overhead of bookkeeping steals and managing sync points only occurs when steals occur. If large pieces of work are stolen, this should occur infrequently. Most of the time, threads are pushing/popping local work from their local dequeue. </p>
</li>
<li><p>Cilk uses greedy join scheduling. </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/12/08-Metaprogramming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/12/08-Metaprogramming/" class="post-title-link" itemprop="url">08. Metaprogramming</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-12 19:13:47 / Modified: 19:51:22" itemprop="dateCreated datePublished" datetime="2022-05-12T19:13:47+08:00">2022-05-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p><code>Makefile</code> contains the dependencies and the rules. The rules are commands that described how to go from a complete list of dependencies to the given target.  </p>
</li>
<li><p>The depencies can be declared with <code>:</code>. The file in the left if the dependencies of the file in the right. </p>
</li>
<li><p>Only if any of the dependencies are changed, the file should be rebuild. And <code>make</code> will only rebuild those changed dependencies. </p>
</li>
<li><p>Sematic versioning: It marks the versions with three numbers, <code>major version</code>, <code>minor version</code>, <code>patch version</code>. If a backwards compatible changes is made, only <code>patch version</code> should be changed. If something is added, the <code>minor version</code> will increase, and <code>patch version</code> is set to 0. If a change is not backwards compatible, then <code>major version</code> will be increased. </p>
</li>
<li></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/11/06-Version-Control-git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/06-Version-Control-git/" class="post-title-link" itemprop="url">06.Version Control (git)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-11 13:35:13" itemprop="dateCreated datePublished" datetime="2022-05-11T13:35:13+08:00">2022-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-12 14:14:50" itemprop="dateModified" datetime="2022-05-12T14:14:50+08:00">2022-05-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Git-Model"><a href="#Git-Model" class="headerlink" title="Git Model"></a>Git Model</h1><ol>
<li><p>Folders are called <code>trees</code>, and files are called <code>blobs</code>. Trees can have other trees and blobs, while blobs cannot have trees. </p>
</li>
<li><p>Git keeps snapshots of the file system, and arrange them in a form of tree according to commits. </p>
</li>
<li><p>One snapshot has only one parant snapshot, but may have multiple children. Those children contains different commits, and don’t share their new changes.<br>We can merge snapshots together to get all changes in all snapshots. Sometimes this process is automatically, but there are some cases when it trigues the merge conflict. </p>
</li>
<li><p>Actually, git stores versions not by snapshots, but by commits. Each commit contains not only the snapshot of the file system snapshot, but also some metadata, like the author, message and parent of this commit. </p>
</li>
<li><p>Git calculates the hash name of a commit through Sha-1 algorithm, which is a 40 character hex code.<br>So references is provided to refer a human-readable name to a hash name. While the human-readable name is changeable, the hash name cannot be changed. </p>
</li>
</ol>
<h1 id="Git-Commands"><a href="#Git-Commands" class="headerlink" title="Git Commands"></a>Git Commands</h1><ol>
<li><p><code>git init</code> will create a <code>.git</code> folder, and make the current folder into a git folder</p>
</li>
<li><p><code>git help &lt;git command&gt;</code> can show the document of that command. Don’t need <code>git</code> in git command. </p>
</li>
<li><p><code>git status</code> will show the status of changes compared the current file system with its parent. It will only show blobs or trees, not the details.<br><code>git log</code> will show all the commits in history in a flat form, including author, date and message. <code>git log --all --graph --decorate</code> can show the history more beautiful, and the relations more clear. <code>--oneline</code> will show some more simplified information. </p>
</li>
<li><p><code>git add &lt;file path&gt;</code> can add a changed file to the next commit.<br><code>git commit</code> will commit every changes that have been added. </p>
</li>
<li><p><code>git cat-file -p &lt;hash name&gt;</code> will show what is in the object with that hash name. The object might be a commit, a snapshot, a tree or a blob. </p>
</li>
<li><p><code>HEAD</code> is the current commit you are looking, and <code>master</code> is the up-to-date commit.<br><code>git checkout &lt;hash name&gt;</code> will change the current working space  to that commit, and the <code>HEAD</code> will point to that commit. This will change all the files into the snapshot of the commit.<br>If we want to go to master, we can use <code>master</code> instead of <code>&lt;hash name&gt;</code>. </p>
</li>
<li><p><code>git diff</code> will show the differet between the current file system and <code>HEAD</code> commit. It will not only show the file-names, by also what is changed in those files.<br>It can takes some arguments, like <code>git &lt;hash name1&gt; &lt;hash name2&gt; &lt;file name&gt;</code>. In this case, it will only compare the state of that file between that two commits. </p>
</li>
<li><p>When the <code>HEAD</code> is pointing to the end of a branch, and we make a commit, <code>HEAD</code> that that branch mark will both point to the new commit.<br><code>git branch</code> will list all the braches we have. <code>Master</code> is a special brach that will be created from the beginning.<br><code>git brach &lt;name&gt;</code> will name the commit <code>HEAD</code> is pointing to that name.<br><code>git checkout &lt;branch name&gt;</code> will point the <code>HEAD</code> to that brach mark. <code>-b</code> flag will create and check out that branck. </p>
</li>
<li><p><code>git merge &lt;branch name&gt;</code> will merge the commit that branch mark points to into the <code>HEAD</code> commit.<br>If the <code>HEAD</code> commit is a predecessor of that branch, a fast-forward merging is used, which simply move the <code>HEAD</code> to that branch.<br>Or Git will do its best to auto-merge the changes, but sometimes it might get confused, so a merge conflict is raised. We can manually fix those conflicts, and use <code>git add</code> to add the changed files again, use <code>git merge --continue</code> to finish the merge. </p>
</li>
</ol>
<h1 id="Git-Remote"><a href="#Git-Remote" class="headerlink" title="Git Remote"></a>Git Remote</h1><ol>
<li><p><code>git remote</code> will print all the remotes that git is aware of for the current repository</p>
</li>
<li><p><code>git remote add &lt;name&gt; &lt;url&gt;</code>. The name is <code>origin</code> by convention. </p>
</li>
<li><p><code>git push &lt;remote name&gt; &lt;local branch&gt;:&lt;remote branch&gt;</code> will set the branch in the remote to the local branch. If that remote branch doesn’t exist, it will be created.<br>We can use <code>git branch --set-upstream-to=&lt;remote name&gt;/&lt;remote branch&gt;</code> so that we will push the current branch to the set remote branch by default. </p>
</li>
<li><p><code>git clone &lt;url&gt; &lt;foler name&gt;</code> will clone the repo into the local folder.<br><code>--shallow</code> will only get the latest snapshot, not the whole history. </p>
</li>
<li><p><code>git fetch &lt;remote name&gt;</code> will retrieve the changes in the remote. But it will not change anything we have locally, and the local master branch is still pointing to where it was. We can use <code>git merge</code> to move master branch.<br><code>git pull &lt;remote name&gt;</code> will fetch and merge. </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/10/05-Commandline-Environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/10/05-Commandline-Environment/" class="post-title-link" itemprop="url">05. Commandline Environment</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-10 15:43:00" itemprop="dateCreated datePublished" datetime="2022-05-10T15:43:00+08:00">2022-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-11 13:35:38" itemprop="dateModified" datetime="2022-05-11T13:35:38+08:00">2022-05-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Job-Control"><a href="#Job-Control" class="headerlink" title="Job Control"></a>Job Control</h1><ol>
<li><p>The unit of argument of <code>sleep</code> is second. </p>
</li>
<li><p><code>Ctrl + C</code> sends a <code>SIGINT</code> (interrupt program, can be captured by programs and do something else)<br><code>Ctrl + \</code> sends a <code>SIGQUIT</code> (quit program, cannot be captured by programs)<br><code>Ctrl + Z</code> sends a <code>SIGSTOP</code> (stop or suspend program,cannot be caught or ignored)</p>
</li>
<li><p>Add a <code>&amp;</code> at the end of a command, it will run on background. </p>
</li>
<li><p><code>jobs</code> can show all the jobs in the shell.<br><code>bg %[number]</code> can run a job on background. The number is the same as what showed in <code>jobs</code>.<br><code>fg %[number]</code> can bring a job to the frontground.<br><code>kill %[number]</code> can do more than kill a program. With flags, it can send any signal to that program. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bg %1</span><br><span class="line">kill -STOP %1 # only suspend, don't kill</span><br></pre></td></tr></table></figure>
</li>
<li><p>When a program get a <code>SIGHUP</code>, it will hung up and close. But we can prevent that by add a <code>nohup</code> at the begining of the command. </p>
</li>
</ol>
<h1 id="Terminal-multiplexer-tmux"><a href="#Terminal-multiplexer-tmux" class="headerlink" title="Terminal multiplexer (tmux)"></a>Terminal multiplexer (tmux)</h1><ol>
<li><p>Normally, when the ssh is closed, a SIGHUP will be sent to the session. But tmux wrapped the session to ignore that SIGUP. </p>
</li>
<li><p>Sessions have windows, and windows have panes. Windows like tabs in web browser. </p>
</li>
<li><p>We can create a new session with different commands.<br><code>tmux</code> will create with a default number of a number that starts from 0.<br><code>tmux new -t [name]</code> will create with a specific name.<br>We can attach to a session with <code>tmux attach -t [name]</code> or <code>tmux a -t [name]</code></p>
</li>
<li><p>When in a tmux session, <code>Ctrl + B</code> will enter the command mode. The way to use it is to press <code>Ctrl + B</code> and release it to press other command keys. </p>
</li>
<li><p><code>d</code> will detach session, but won’t kill it. <code>Ctrl + D</code> (without <code>Ctrl + B</code>) will kill the session.<br><code>$</code> can rename a session. </p>
</li>
<li><p><code>c</code> will create a new window.<br>When there are multiple windows, <code>Ctrl + D</code> will close the current window without closing the session.<br><code>[number]</code> will jump to the window indexed by that number, and it can have only one digit. However, <code>&#39;</code> can enter any number and jump in.<br><code>,</code> can rename the current window, but the indices remain unchanfed. </p>
</li>
<li><p><code>&quot;</code> will split the current pane horizontally, while <code>%</code> will split vertically.<br>When there are multiple panes, <code>Ctrl + D</code> will now close the current pane without closing the window.<br>The arrow keys can switch between panes.<br><code>space</code> will change through different layouts.<br><code>z</code> will zoom the current pane to take all the space or go back to multiple panes at the same time. </p>
</li>
<li><p><code>s</code> will allow us to see and select all the sessions, widowns and panes.<br><code>Right arraw</code> can expand sessions with multiple widows or windows with multiple panes. <code>Left arraw</code> can collapse them.<br><code>Enter</code> can select a session, window, or a pane. </p>
</li>
<li><p><code>f</code> can find windows according to their name, not index. When none is matching, all will show up. </p>
</li>
</ol>
<h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><ol>
<li><p>Log in ssh with <code>ssh [username]@[IP address]</code>. The <code>IP address</code> can be either an IP or a DNS. Log out with <code>logout</code> in the shell in server. </p>
</li>
<li><p><code>ssh</code> can have a second argument which is the command we want to perform on the server. It will return to our local shell immediately, and print the contents in the server. </p>
</li>
<li><p>SSH Key can allow us to log in a server without enter the password.<br>First, we need to generate the SSH Key locally with <code>ssh-keygen</code>. That command will create two files in <code>~/.ssh/</code>, and one of them ends with <code>.pub</code>. The <code>.pub</code> file contains the public key we just generated, and copy it into the <code>~./ssh/authorized_keys</code> in server.<br>If we opened passphrase in SSH Key, it can protect our private key, but we still need to type it when we try to use the private key. <code>ssh-copy-id [user]@[IP address]</code> can skip passphrase in this computer. </p>
</li>
<li><p><code>scp [from address] [to address]</code></p>
</li>
<li><p>We can set configurations of hosts in <code>~/.ssh/config</code>. Then we can log in with <code>ssh [host alias]</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host [host alias]</span><br><span class="line"> User [<span class="built_in">log</span> in user name]</span><br><span class="line"> HostName [<span class="built_in">log</span> in IP address]</span><br><span class="line"> IdentityFile [private key address]</span><br><span class="line"> RemoteForward []</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/09/04-Data-Wrangling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/09/04-Data-Wrangling/" class="post-title-link" itemprop="url">04. Data Wrangling</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-09 16:21:26 / Modified: 16:21:52" itemprop="dateCreated datePublished" datetime="2022-05-09T16:21:26+08:00">2022-05-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/09/03-Vim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/09/03-Vim/" class="post-title-link" itemprop="url">03. Vim</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-09 10:55:04 / Modified: 15:20:00" itemprop="dateCreated datePublished" datetime="2022-05-09T10:55:04+08:00">2022-05-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Normal-mode"><a href="#Normal-mode" class="headerlink" title="Normal mode"></a>Normal mode</h1><p>Access when first start up vim or <code>esc</code> in other modes. This is for navigating around a file, reading things, going from file to file. </p>
<h2 id="Moving"><a href="#Moving" class="headerlink" title="Moving"></a>Moving</h2><ol>
<li><p>We can move our cursor with hjkl. <code>j</code> will move down, <code>k</code> will move up, <code>h</code> will move left, and <code>l</code> will move right</p>
</li>
<li><p><code>w</code> will move the cursor forward by one word, <code>b</code> will move the cursor backward by one word. <code>e</code> will move to the end of word. </p>
</li>
<li><p><code>0</code> will move to the beginning of the line, and <code>$</code> will move to the end of the line. <code>^</code> will move to the first non-empty character on the line. </p>
</li>
<li><p><code>Ctrl + u</code> and <code>Ctrl + d</code> will move up or down the entire page.<br><code>G (Cap)</code> will move to the end of the file. <code>gg</code> will move to the beginning of the file. </p>
</li>
<li><p><code>L (Cap)</code>, <code>M(Cap)</code>, and <code>H (Cap)</code> will move to the lowest, middle, and highest line shown on the screen. </p>
</li>
<li><p><code>f / t + character</code> will jump before or to the first <code>character</code> in that line behind the cursor, and <code>F / T (Cap) + character</code> will jump after or to the last character in that line before the cursor. </p>
</li>
<li><p>When the cursor is in a parenthesis, <code>%</code> can quikly move between the matching parentheses. </p>
</li>
<li><p>We can start searching with <code>/</code>. Then we can type in the text we want to search and press enter. The cursor will jump to the first matched pattern after the cursor.<br>If the first match is not what we want, we can use <code>n</code> to find the next one. </p>
</li>
</ol>
<h2 id="Editing"><a href="#Editing" class="headerlink" title="Editing"></a>Editing</h2><ol>
<li><p><code>o</code> and <code>O</code> will open a new line below or above the cursor and enter the insert move. </p>
</li>
<li><p><code>d</code> combined with movement commands will delete contents.<br><code>c</code> (change) combined with movement commands will also delete contens and enter the insert mode.<br><code>dd</code> and <code>cc</code> will act on the given line. </p>
</li>
<li><p><code>x</code> will delete the character in the cursor. </p>
</li>
<li><p><code>r + character</code> will replace the charater in the cursor to the given character. </p>
</li>
<li><p><code>u</code> and <code>Ctrl + R</code> will undo and redo the editing. If the last editing is entering the insert mode and editing something, vim will undo all the editing in the insert mode. But if you just used some commands in normal mode, vim will undo only the last command. </p>
</li>
<li><p><code>y</code> combined with movement command will copy contents (y for yank). <code>p</code> will paste contents. <code>yy</code> will copy the whole line. </p>
</li>
<li><p><code>~</code> will flip the case on the cursor. </p>
</li>
<li><p><code>.</code> will repeat the last editing command again. The commands here is the same as <code>u</code>. </p>
</li>
</ol>
<h2 id="Counting"><a href="#Counting" class="headerlink" title="Counting"></a>Counting</h2><ol>
<li><p>Counting can be use to do all those commands repeatedly. </p>
</li>
<li><p>Just type the times we want to repeat before the command. Even a number larger than 10 is supported. </p>
</li>
<li><p>For editing commands that requires extra movement commands, like <code>d</code>, the number could be either before the editing command, or between the editing command and movement command. </p>
</li>
</ol>
<h2 id="Modifier"><a href="#Modifier" class="headerlink" title="Modifier"></a>Modifier</h2><ol>
<li><p>There are two kind of modifiers <code>i</code> and <code>a</code>. They require symbols that have a match, like parentheses or quotes. </p>
</li>
<li><p><code>i</code> means the things inside the matched symbols, and those symbols are not included.<br><code>a</code> is justl ike <code>i</code>, but symbols included. </p>
</li>
<li><p>They can combine with editing commands. Move the cursor into the symbols and type <code>editing command + i/a + symbol</code></p>
</li>
</ol>
<h1 id="Other-Modes"><a href="#Other-Modes" class="headerlink" title="Other Modes"></a>Other Modes</h1><ol>
<li><p>Insert: access via <code>i</code> in normal mode. editing file</p>
</li>
<li><p>Replace: access via <code>R (Cap)</code></p>
</li>
</ol>
<h2 id="Visual-Mode"><a href="#Visual-Mode" class="headerlink" title="Visual Mode"></a>Visual Mode</h2><ol>
<li>To select the contents we want to copy more convenient, we can first move the cursor to the first or the last character we want, and use <code>v</code> to enter the visual mode. In visual mode, we can move cursor to select the contents between the current position and the position when we just entered. </li>
<li><code>V (cap)</code> will enter the visual-line mode, which will select the lines. </li>
<li><code>Ctrl + V</code> will enter the visual-block mode, which will select the rectangualer blocks of text with the original and current cursor being the upper-left and lower-right corner. </li>
<li>After the selection, we can use the commands in normal mode, which will act on the whole thing and turn back to normal mode. Frequently used commands like <code>y</code> and <code>~</code></li>
<li>Countings and modifiers are still supported. </li>
</ol>
<h2 id="Command-Line-Mode"><a href="#Command-Line-Mode" class="headerlink" title="Command Line Mode"></a>Command Line Mode</h2><ol>
<li><p>Command line: access via <code>:</code>. Line shell command, but type in vim command, which all starts with <code>:</code>. </p>
</li>
<li><p><code>:q</code> will quit vim, <code>:w</code> will save file</p>
</li>
<li><p><code>:help</code> will show the document of commands. And quit the document with <code>:q</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">help</span> :<span class="keyword">w</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Buffer and window is not always one-to-one correspondence. Each buffer can be opened in zero or more windows.<br>We can create multiple windows with command <code>:sp</code>, or create different tabs with <code>:tabnew</code>.<br><code>:q</code> will only close the current window, and <code>:qa</code> will close all the windows. </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/08/02-Shell-Tools-and-Scripting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/02-Shell-Tools-and-Scripting/" class="post-title-link" itemprop="url">02. Shell Tools and Scripting</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-08 14:36:05" itemprop="dateCreated datePublished" datetime="2022-05-08T14:36:05+08:00">2022-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-09 10:54:42" itemprop="dateModified" datetime="2022-05-09T10:54:42+08:00">2022-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>Variables: In shell, we can assign variables and access them by adding a <code>$</code> before its name. When assigning a variable, there is no extra space.<br>We can assign the output of a command with <code>$()</code>. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo=bar</span><br><span class="line">foo=$(pwd)</span><br></pre></td></tr></table></figure>
</li>
<li><p>We can express a string with either double quotes or single quotes. The difference is that double quotes will replace the variables inside with their value, and single quotes will not do so. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo "Value is $foo" # result: Value is bar</span><br><span class="line">echo 'Value is $foo' # result: Value is $foo</span><br><span class="line"></span><br><span class="line">echo "We are in $(pwd)" # result: We are in /...</span><br><span class="line">echo 'We are in $(pwd)' # result: We are in $(pwd)</span><br></pre></td></tr></table></figure>
</li>
<li><p>We can define a shell function in a <code>.sh</code> file. After we ran the source command, we can use it as other shell commands. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source mcd.sh</span><br><span class="line">mcd xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>In shell commands, we can use <code>||</code> and <code>&amp;&amp;</code> to connect commands. Just like in C, only the left command of <code>||</code> gets an error, will the right command be executed. And only the left command of <code>&amp;&amp;</code> is correct, will the right command be executed.<br>Two commands can always be separated by a semi-colon. </p>
</li>
<li><p>```shell<br>true || echo “This will not be printed”<br>false &amp;&amp; echo “This will not be printed”</p>
<p>false || echo “This will be printed”<br>true &amp;&amp; echo “This will be printed”</p>
<p>true ; echo “This will be printed”<br>false ; echo “This will be printed”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">6. &#96;&#96;&lt;()&#96;&#96; can set the output of the command in parentheses as the input stream. </span><br><span class="line">   </span><br><span class="line">   &#96;&#96;&#96;shell</span><br><span class="line">   cat &lt;(ls) &lt;(ls ..)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>$0</code> is the name of the function, <code>$1</code> is the first parameter, and so on. <code>$?</code> and <code>$_</code> is the error code and the last argument of the previous command. <code>$#</code> is the number of given arguments. <code>$$</code> is the process ID. <code>$@</code> will expand to all arguments, and then we can use for-loop to traverse it </p>
</li>
<li><p>We can use <code>{}</code> to simply the arguments we write. They will be expand to multiple arguments being the string outside concatenated with strings inside.<br>We can also expand to a range like <code>{a..d}</code> (a and j included)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">project&#123;,1,2&#125;/src/test&#123;a..b&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> project/src/testa project/src/testb project1/src/testa projec1/src/testb project2/src/testa project2/src/testb</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>We can use <code>*</code> to match any string (even include the empty string). And we can use <code>?</code> to match one singel character. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls *.sh</span><br><span class="line">ls project?</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>shellcheck</code> can check the scripts we write. </p>
</li>
<li><p><code>find</code> command: It can find files recursively. It has may arguments which make it powerful.<br>After <code>find</code>, it can specify the path to begin the search. By default, the path will be the current space.<br>It will search according to the argement of <code>-name</code> (case sensitive) or <code>-iname</code> (case insensitive)<br><code>-type</code> can specify the type of file we want. <code>f</code> means regular files, <code>d</code> is directory, etc.<br><code>-exec</code> can tell the shell what do we want to do with those found files in the form of <code>command {} \</code>. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find . -name "*.c"</span><br><span class="line">find \home -type d -name "project?"</span><br><span class="line">find \usr\Developer -type d -name "tmp*" -exec rm -rf &#123;&#125; \</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>locate</code> command need to create a database of all files in the system. Then every time, it will search the database to find all paths that match the pattern.<br>When try to find a directory, it will not only list the path of the directory, it also will lists all the files in that directory. </p>
</li>
<li><p><code>grep</code> command will print all  lines in the input file that match the pattern. The first argument is the pattern string, and the second is the path of the file. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep torch *.py</span><br></pre></td></tr></table></figure>
</li>
<li></li>
<li><p><code>history</code> command can show all the commands we used before. </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2022/05/06/01-The-Shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/06/01-The-Shell/" class="post-title-link" itemprop="url">01. The Shell</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-06 14:53:14" itemprop="dateCreated datePublished" datetime="2022-05-06T14:53:14+08:00">2022-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-08 14:36:36" itemprop="dateModified" datetime="2022-05-08T14:36:36+08:00">2022-05-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/MIT-The-Missing-Semester-of-You-CS-Education/" itemprop="url" rel="index">
                    <span itemprop="name">MIT The Missing Semester of You CS Education</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>Command <code>echo</code> will print the parameter. </p>
</li>
<li><p>When a parameter is formed by multiple words, you can wrap them with double quotes or use a ‘\’ before space. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo "Hello World"</span><br><span class="line">echo Hello\ World</span><br></pre></td></tr></table></figure>
</li>
<li><p>The variable <code>$PATH</code> contains all the paths on the machine that the shell will search for programs. Each time we run a shell command, it will search all the pahts to find a program with the same name as the command. </p>
</li>
<li><p>To find the path of a command or a program, we can use <code>which</code>. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which echo</span><br></pre></td></tr></table></figure>
</li>
<li><p>Different directories of a path is separated by forward slashes ‘/‘ in Linux or MacOS and back slashes ‘\’ in Windows.<br>All paths in Linux or MacOS starts from the same root, so they all begins with a ‘/‘. In Windows, they might start from different disks like C: or D:. </p>
</li>
<li><p><code>pwd</code> returns the present working directory. We can chage it with <code>cd</code>.<br>There are some special directories. ‘/‘ is the root director. ‘~’ is the home directory. ‘-‘ is the last directory you were in. </p>
</li>
<li><p>We can see all the files in the current directory with <code>ls</code>. It can also takes a parameter that is a path, and then we can see the files in that path.<br>With <code>ls -l</code>, it will show more details about files.<br>The first character of the first column is always ‘d’ or ‘-‘. If it is a ‘d’, then that file is a directory.<br>The rest 9 characters of the first column is the permissions of each users. The first 3 are for the owner of the file showed in the second column. The second 3 are for the group of users that own the file showed in the third column. The Third 3 are for everyone else.<br>‘r’ stands for read. For a directory, that means that if you are allowed to see which files are inside<br>‘w’ stands for write. For a directory, that means that if you are allowed to rename, create or remove files in that directory.<br>‘x’ stands for execution. For a directory, that means the if you are allowed to enter that directory. To enter a directory, you need all the executions of the its all parents and itself. </p>
</li>
<li><p><code>mv</code>: The first parameter is the old path, while the second is the new path. They are both full paths. When the paths only differ in the last file, it acts as renaming the old file.<br><code>cp</code>: Almost the same as <code>mv</code>, except it only copies the first file without deleting it.<br><code>rm</code>: It has only one parameter, and deletes that file. </p>
</li>
<li><p><code>rmdir</code>: Delete an empty directory. <code>rm</code> also cannot delete a non-empty directory, but we can use <code>rm -rf</code> to delete recursively.<br><code>mkdir</code>: It will create a directory. If it has multiple parameters separated by space, it will create one directory for each parameter. </p>
</li>
<li><p><code>cat</code>: It will print the contents of a file.<br><code>tail</code>: It will print the last n lines of the file. We can use <code>-n</code> to specify the number of lines. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -n1 hello.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>man</code>: It will show the manuscript of a command given as a parameter. </p>
</li>
<li><p><code>Ctrl + L</code> will clean the terminal. </p>
</li>
<li><p>We can assign the input stream to a specified file with left angle braket <code>&lt; file</code>, and assign the output stream with <code>&gt; file</code>. </p>
<p>When using <code>&gt; file</code>, it will delete the original contents. But when using <code>&gt;&gt; file</code>, it will just append new contents to the file.<br>When we assign the input stream of <code>cat</code> to a file, it will still print the contents of that file. If the input file is the same as the output file and we are using <code>&gt;&gt;</code>, it will cause a dead-loop. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo hello &gt; hello.txt</span><br><span class="line">cat &lt; hi.txt &gt;&gt; hello.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>The character <code>|</code> creates a pipe that uses the output of the left command as the input of the right command. </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l / | tail -n1</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LiyunZhang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">LiyunZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">227</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liyun Zhang</span>
</div>
<div class="BbeiAn-info">
       浙ICP备 -
    <a target="_blank" href="http://www.miitbeian.gov.cn/" style="color:#ffffff"  rel="nofollow">19047088号-1</a> <!--a标签中增加nofollow属性，避免爬虫出站。-->|
    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001835" style="color:#ffffff;text-decoration:none;padding-left:30px;background:url(https://s1.ax1x.com/2018/09/29/ilmwIH.png) no-repeat left center" rel="nofollow">浙公网安备 33011802001835号</a>      <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->

</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

</body>
</html>
