<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://http://www.laughingtree.cn').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":true},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="UserDefaults It only stores Property List data. Property List is any combo of Array, Dictionary, String, Date, Data or a number (Int, etc.). Mark that CGFloat is not allowed.  We don’t usually create">
<meta property="og:type" content="article">
<meta property="og:title" content="13&amp;14. Persistence and Documents">
<meta property="og:url" content="http://http//www.laughingtree.cn/2019/08/21/13&14-Persistence-and-Documents/index.html">
<meta property="og:site_name" content="LaughingTree">
<meta property="og:description" content="UserDefaults It only stores Property List data. Property List is any combo of Array, Dictionary, String, Date, Data or a number (Int, etc.). Mark that CGFloat is not allowed.  We don’t usually create">
<meta property="og:image" content="http://http/img/13&amp;14.PersistenceandDocuments01.png">
<meta property="og:image" content="http://http/img/13&amp;14.PersistenceandDocuments02.png">
<meta property="article:published_time" content="2019-08-21T15:09:24.000Z">
<meta property="article:modified_time" content="2020-08-07T11:26:56.155Z">
<meta property="article:author" content="LiyunZhang">
<meta property="article:tag" content="应用开发">
<meta property="article:tag" content="Swift">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://http/img/13&amp;14.PersistenceandDocuments01.png">

<link rel="canonical" href="http://http//www.laughingtree.cn/2019/08/21/13&14-Persistence-and-Documents/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>13&14. Persistence and Documents | LaughingTree</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LaughingTree</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">31</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://http//www.laughingtree.cn/2019/08/21/13&14-Persistence-and-Documents/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="LiyunZhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LaughingTree">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          13&14. Persistence and Documents
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-21 23:09:24" itemprop="dateCreated datePublished" datetime="2019-08-21T23:09:24+08:00">2019-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-07 19:26:56" itemprop="dateModified" datetime="2020-08-07T19:26:56+08:00">2020-08-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学与技术</span>
                  </a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/Swift%E5%BC%80%E5%8F%91-Stanford-CS193p/" itemprop="url" rel="index">
                    <span itemprop="name">Swift开发 (Stanford CS193p)</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="UserDefaults"><a href="#UserDefaults" class="headerlink" title="UserDefaults"></a>UserDefaults</h1><ol>
<li>It only stores Property List data. Property List is any combo of Array, Dictionary, String, Date, Data or a number (Int, etc.). Mark that CGFloat is not allowed. </li>
<li>We don’t usually create one of these databases with <code>UserDefaults()</code>. Instead, you use the static (type) var called <code>standard</code></li>
<li>It just stores and retrieves Property Lists by key.<br>Set property: <code>func set(Any?, forKey: String)</code><br>Get property: <code>func object(forKey: String) -&gt; Any?</code><a id="more"></a></li>
<li>UserDefaults also has API for getting the Property List types as a specific type. </li>
<li>Your database changes will be occasionally autosaved. But you can force them to be saved at any time with synchronize. It’s not “free” to synchronize, but it’s not that expensive either. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 2</span></span><br><span class="line"><span class="keyword">let</span> defaults = <span class="type">UserDefaults</span>.standard</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 3</span></span><br><span class="line"><span class="comment">// Set property</span></span><br><span class="line">defaults.<span class="keyword">set</span>(<span class="number">3.1415</span>, forKey: “pi”)</span><br><span class="line">defaults.<span class="keyword">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], forKey: “<span class="type">My</span> <span class="type">Array</span>”)</span><br><span class="line">defaults.<span class="keyword">set</span>(<span class="literal">nil</span>, forKey: “<span class="type">Some</span> <span class="type">Setting</span>”)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get property</span></span><br><span class="line">defaults.object(forKey: “pi”)</span><br><span class="line">defaults.object(forKey: “<span class="type">My</span> <span class="type">Array</span>”)</span><br><span class="line">defaults.object(forKey: “<span class="type">Some</span> <span class="type">Setting</span>”)</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 4</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">double</span><span class="params">(forKey: String)</span></span> -&gt; <span class="type">Double</span>                     <span class="comment">// returns 0 if non-Double at that key</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">array</span><span class="params">(forKey: String)</span></span> -&gt; [<span class="type">Any</span>]?                        <span class="comment">// returns nil if non-Array at that key </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dictionary</span><span class="params">(forKey: String)</span></span> -&gt; [<span class="type">String</span>:<span class="type">Any</span>]?     <span class="comment">// note that keys in return are Strings</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// . 5</span></span><br><span class="line"><span class="keyword">if</span> !defaults.synchronize()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// failed! but not clear what you can do about it </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Archiving"><a href="#Archiving" class="headerlink" title="Archiving"></a>Archiving</h1><h2 id="NSCoder-Old-Mechanism"><a href="#NSCoder-Old-Mechanism" class="headerlink" title="NSCoder (Old Mechanism)"></a>NSCoder (Old Mechanism)</h2><ol>
<li>Requires all objects in an object graph to implement these two methods. </li>
<li>This is how storyboard saved. </li>
<li>Essentially you store all of your object’s data in the coder’s dictionary. Then you have to be able to initialize your object from a coder’s dictionary. </li>
<li>References within the object graph are handled automatically. </li>
<li>You can then take an object graph and turn it into a Data (via <code>NSKeyedArchiver</code>). And then turn a Data back into an object graph (via <code>NSKeyedUnarchiver</code>). </li>
<li><p>Once you have a Data, you can easily write it to a file or otherwise pass it around. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encode</span><span class="params">(with aCoder: NSCoder)</span></span></span><br><span class="line"><span class="keyword">init</span>(coder: <span class="type">NSCoder</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Codable-New-Mechanism"><a href="#Codable-New-Mechanism" class="headerlink" title="Codable (New Mechanism)"></a>Codable (New Mechanism)</h2><ol>
<li>Also is essentially a way to store all the vars of an object into a dictionary. To do this, all the objects in the graph of objects you want to store must implement Codable.</li>
<li>But the difference is that, for standard Swift types, Swift will do this for you. If you have non-standard types, you can do something similar to the old method.</li>
<li>Once your object graph is all Codable, you can convert it to either JSON or a Property List. Note that this encode throws. </li>
<li>You can make a String object out of this Data. </li>
<li>To get your object graph back from the JSON. It has four kinds of errors, <code>DecodingError.keyNotFound</code>, <code>DecodingError.valueNotFound</code>, <code>DecodingError.typeMismatch</code>, and <code>DecodingError.dataCorrupted</code></li>
<li>JSON is not “strongly typed.” So things like Date or URL are just strings. </li>
<li>Swift handles all this automatically and is even configurable. </li>
<li>Sometimes JSON keys might have different names than your var names (or not be included). You can configure this by adding a private enum to your type called CodingKeys. </li>
<li>You can participate directly in the decoding by implementing the decoding initializer. Note that this init throws, so we don’t need do { } inside it (it will just rethrow).<br>Also note the “keys” are from the CodingKeys enum (e.g. .someDate). Don’t call super.init with your own decoder (use your container’s superDecoder()). </li>
<li>If we want our own structure or class codable, we just conform prorocol <code>Codable</code>. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 3</span></span><br><span class="line"><span class="keyword">let</span> object: <span class="type">MyType</span> = ...</span><br><span class="line"><span class="keyword">let</span> jsonData: <span class="type">Data?</span> = <span class="keyword">try</span>? <span class="type">JSONEncoder</span>().encode(object)</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 4</span></span><br><span class="line"><span class="keyword">let</span> jsonString = <span class="type">String</span>(data: jsonData!, encoding: .utf8) <span class="comment">// JSON is always utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// . 5</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> object = <span class="keyword">try</span> <span class="type">JSONDecoder</span>().decode(<span class="type">MyType</span>.<span class="keyword">self</span>, from: jsonData!)</span><br><span class="line">	<span class="comment">// success, do something with object</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">DecodingError</span>.keyNotFound(<span class="keyword">let</span> key, <span class="keyword">let</span> context)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// …</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">DecodingError</span>.valueNotFound(<span class="keyword">let</span> type, <span class="keyword">let</span> context)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// …</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">DecodingError</span>.typeMismatch(<span class="keyword">let</span> type, <span class="keyword">let</span> context)</span><br><span class="line">&#123;</span><br><span class="line">  	<span class="comment">// …</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> <span class="type">DecodingError</span>.dataCorrupted(<span class="keyword">let</span> context)</span><br><span class="line">&#123;</span><br><span class="line">  	<span class="comment">// …</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 7</span></span><br><span class="line"><span class="keyword">let</span> decoder = <span class="type">JSONDecoder</span>()</span><br><span class="line">decoder.dateDecodingStrategy = .iso8601 <span class="comment">// or .secondsSince1970, etc. </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// . 8</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyType</span> : <span class="title">Codable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> someDate: <span class="type">Date</span></span><br><span class="line">	<span class="keyword">var</span> someString: <span class="type">String</span></span><br><span class="line">	<span class="keyword">var</span> other: <span class="type">SomeOtherType</span> <span class="comment">// SomeOtherType has to be Codable too!</span></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span> : <span class="title">String</span>, <span class="title">CodingKey</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">		<span class="keyword">case</span> someDate = “some_date”</span><br><span class="line">		<span class="comment">// note that the someString var will now not be included in the JSON</span></span><br><span class="line">		<span class="keyword">case</span> other <span class="comment">// this key is also called “other” in JSON </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 9</span></span><br><span class="line"><span class="keyword">init</span>(from decoder: <span class="type">Decoder</span>) <span class="keyword">throws</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> container = <span class="keyword">try</span> decoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">  someDate = <span class="keyword">try</span> container.decode(<span class="type">Date</span>.<span class="keyword">self</span>, forKey: .someDate)</span><br><span class="line">  <span class="comment">// process rest of vars, perhaps validating input, etc. ...</span></span><br><span class="line">	<span class="keyword">let</span> superDecoder = <span class="keyword">try</span> container.superDecoder()</span><br><span class="line">	<span class="keyword">try</span> <span class="keyword">super</span>.<span class="keyword">init</span>(from: superDecoder) <span class="comment">// only if class</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="File-System"><a href="#File-System" class="headerlink" title="File System"></a>File System</h1><ol>
<li>Your application sees iOS file system like a normal Unix filesystem. It starts at <code>/.</code></li>
<li>There are file protections, of course, like normal Unix, so you can’t see everything. In fact, you can only read and write in your application’s “sandbox”.</li>
<li>Sandbox has three great features.<br>Security (so no one else can damage your application)<br>Privacy (so no other applications can view your application’s data)<br>Cleanup (when you delete an application, everything it has ever written goes with it)</li>
<li>In the sandbox, there are four main files.<br>Application directory — Your executable, .storyboards, .jpgs, etc.; not writeable. If have to write, copy to somewhere else then write.<br>Documents directory — Permanent storage created by and always visible to the user in the File app.<br>Application Support directory — Permanent storage not seen directly by the user.<br>Caches directory — Store temporary files here (this is not backed up by iTunes).</li>
<li>We can create those files in sandbox with <code>FileManager.default.url</code>. It returns a URL which is the URL of one of the files in sandbox. </li>
<li>FileManager (along with URL) is what you use to find out about what’s in the file system. </li>
<li>Reading binary data from a URL and Writing binary data to a URL. The options can be things like <code>.atomic</code> (write to tmp file, then swap) or <code>.withoutOverwriting</code>. </li>
<li>Reading acrions usually happens at <code>viewWillAppear</code>.  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 5</span></span><br><span class="line"><span class="keyword">let</span> url: <span class="type">URL</span> = <span class="type">FileManager</span>.<span class="keyword">default</span>.url(</span><br><span class="line">	<span class="keyword">for</span> directory: <span class="type">FileManager</span>.<span class="type">SearchPathDirectory</span>.documentDirectory, <span class="comment">// for example </span></span><br><span class="line">  <span class="keyword">in</span> domainMask: .userDomainMask <span class="comment">// always .userDomainMask on iOS</span></span><br><span class="line">  appropriateFor: <span class="literal">nil</span>, <span class="comment">// only when want to replace a file, it's not nil. Otherwise, it always is nil. </span></span><br><span class="line">  create: <span class="literal">true</span> <span class="comment">// whether to create the system directory if it doesn’t already exist</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 7</span></span><br><span class="line"><span class="keyword">init</span>(contentsOf: <span class="type">URL</span>, options: <span class="type">Data</span>.<span class="type">ReadingOptions</span>) <span class="keyword">throws</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(to url: URL, options: Data.WritingOptions)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>  <span class="comment">// This is an instance method of Data</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Core-Data"><a href="#Core-Data" class="headerlink" title="Core Data"></a>Core Data</h1><ol>
<li>Core Data is essentially a <code>SQL</code> database with an <code>objected-oriented</code> API. So you interact with this database it looks like Swift objects, but behind the scene those Swift objects are actually in a <code>SQL</code> database. </li>
<li>To use Core Data, we need to create a <code>visual mapping</code> (using <code>Xcode tool</code>) between database and objects. Then create and query for objects using object-oriented API. We can access the “columns in the database table” using vars on those objects. </li>
<li>Core Data is access via an <code>NSManagedObjectContext</code>. To get the NSManagedObjectContext, there are two ways.<br>First is check the <code>Use Core Data</code> when create project and that will create a method that will give you the context for you in <code>AppDelegate</code>.<br>Second is use a subclass of UIDocument. </li>
<li>When using it, we first create an instance with the context and use the instance normally. </li>
<li>We can delete objects from the context and save changes to a context which throws. </li>
<li>Query data from that context.<br>First, we create an <code>NSFetchRequest</code> of our class/structure use <code>MyClass.fetchRequest()</code><br>Seconde, we configure the NSPredicate instance such as <code>predicate</code> and <code>sortDescriptors</code><br>Last, we use the <code>fetch</code> method of context and give the NSFetchRequest to it. </li>
</ol>
<h1 id="Cloud-Kit"><a href="#Cloud-Kit" class="headerlink" title="Cloud Kit"></a>Cloud Kit</h1><ol>
<li>It’s a database in the cloud. Simple to use, but with very basic “database” operations. </li>
<li>Since it’s on the network, accessing the database could be slow or even impossible. </li>
<li>It has several important components. Record Type - like a class or struct<br>Fields - like vars in a class or struct<br>Record - an “instance” of a Record Type<br>Reference - a “pointer” to another Record<br>Database - a place where Records are stored<br>Zone - a sub-area of a Database<br>Container - collection of Databases<br>Query - an Database search<br>Subscription - a “standing Query” which sends push notifications when changes occur. </li>
<li>To do this, you must enable iCloud in Project Settings.  Under Capabilities tab, turn on iCloud (On/Off switch). Then, choose CloudKit from the Services.</li>
<li>To create a record in a database.<br>First, we create a container using <code>CKContainer.default.publicCloudDatabase</code><br>Second, we create a record using <code>CKRecord(String)</code><br>Third, we can add a record to another using <code>CKReference(record: , action: )</code><br>Last, we can save the record to container using <code>save(CKRecord, (CKRecord?, NSError?) -&gt; Void)</code>. Remember to handle 29 different <code>CKErrorCodes</code> in the closure. </li>
<li>To query records in database.<br>First, create an <code>NSPredicate</code> and a <code>CKQuery</code> with <code>CKQuery(recordType, predicate)</code>.<br>Then we let the container use the <code>perform(CKQuery, ([CKRecord]?, NSError?) -&gt; void)</code></li>
</ol>
<h1 id="UIDocument"><a href="#UIDocument" class="headerlink" title="UIDocument"></a>UIDocument</h1><h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><ol>
<li>If your application stores user information in a way the user perceives as a “document”. Or if you just want iOS to manage the primary storage of user information. That is when we use the UIDocument. </li>
<li>UIDocument has four main functions.<br>Manages all interaction with storage devices (not just filesystem, but also iCloud, Box, etc.).<br>Provides asynchronous opening, writing, reading and closing of files.<br>Autosaves your document data.<br>Makes integration with Files application essentially free. </li>
</ol>
<h2 id="Create-A-UIDocument"><a href="#Create-A-UIDocument" class="headerlink" title="Create A UIDocument"></a>Create A UIDocument</h2><ol>
<li>Create a subclass UIDocument to add vars to hold the Model of your MVC that shows your “document”. </li>
<li>Then implement one method that writes the Model to a Data and one that reads it from a Data. </li>
<li>You can use UIDocument’s opening, saving and closing methods as needed. </li>
<li>You can also use its “document has changed” method (or implement undo) to get autosaving.</li>
<li>To create a UIDocument, we can use the intializer with a parameter called <code>fileURL</code> type of <code>URL</code>. </li>
<li>Then we just need to assign our whole Model instance at View Controller to the variable at UIDocument instance. </li>
</ol>
<h2 id="Convert-between-Model-and-Data"><a href="#Convert-between-Model-and-Data" class="headerlink" title="Convert between Model and Data"></a>Convert between Model and Data</h2><ol>
<li>Override the <code>contents</code> method in your UIDocument subclass to convert your Model into a Data. </li>
<li>Note that the return type is Any, that’s because file format can also be a FileWrapper. </li>
<li>If you can’t create a Data or FileWrapper, you can throw an error here. </li>
<li>The <code>forType</code> is a <code>UTI (type identifier)</code> calculated from your fileURL’s file extension</li>
<li>A FileWrapper represents a directory full of files that make up your document. </li>
<li>Override the <code>load</code> method in your UIDocument subclass to a Data into an instance of your Model.<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 1</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">contents</span><span class="params">(forType typeName: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Any</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="type">Model</span> converted into a <span class="type">Data</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 6</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">(fromContents contents: <span class="keyword">Any</span>, ofType typeName: String?)</span></span> <span class="keyword">throws</span></span><br><span class="line">&#123;</span><br><span class="line">	emojiArt = contents converted into an instance of <span class="type">Model</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Open-and-Close"><a href="#Open-and-Close" class="headerlink" title="Open and Close"></a>Open and Close</h2><ol>
<li>You can open your document with method <code>open</code> which takes a closure as a parameter. </li>
<li>That closure takes a bool value which represent whether successfully opened that document, <code>true</code> for success and <code>false</code> for fail. </li>
<li>This method is asynchronous. The closure is called on the same thread you call open from (the main thread usually). </li>
<li>The <code>close</code> method is exactly the same. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">myDocument.<span class="keyword">open</span> &#123; success <span class="keyword">in</span></span><br><span class="line">	<span class="keyword">if</span> success</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// your Model var(s) (e.g. emojiArt) is/are ready to use</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// there was a problem, check documentState </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myDocument.close &#123; success <span class="keyword">in</span></span><br><span class="line">	<span class="keyword">if</span> success</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// your Model has successfully been saved and closed</span></span><br><span class="line">		<span class="comment">// use the open method again if you want to use it</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// there was a problem, check documentState </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Save"><a href="#Save" class="headerlink" title="Save"></a>Save</h2><ol>
<li>You can let your document know that the Model has changed with <code>updateChangeCount</code> method. The parameter could also be <code>.undo</code> and <code>.redo</code>. </li>
<li>You can use UIDocument’s <code>undoManager</code>. UIDocument will save your changes automatically at the next best opportunity.</li>
<li>You can force a save using <code>save</code> method which takes a <code>URL</code>, a <code>UIDocumentSaveOperation</code> and a closure like the same in open method. </li>
<li><code>UIDocumentSaveOperation</code> is either <code>.forCreating</code> or <code>.forOverwriting</code>. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// . 1</span></span><br><span class="line">myDocument.updateChangeCount(.done)</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 3</span></span><br><span class="line"><span class="keyword">let</span> url = myDocument.fileURL <span class="comment">// or something else if you want “save as” </span></span><br><span class="line">myDocument.save(to url: <span class="type">URL</span>, <span class="keyword">for</span>: <span class="type">UIDocumentSaveOperation</span>) &#123; success <span class="keyword">in</span></span><br><span class="line">	<span class="keyword">if</span> success </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// your Model has successfully been saved</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// there was a problem, check documentState </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Document-State"><a href="#Document-State" class="headerlink" title="Document State"></a>Document State</h2><ol>
<li>You can find out what state it is in using <code>var documentState: UIDocumentState</code>. </li>
<li>It has the following states. </li>
<li><code>.normal</code> — document is open and ready for use!</li>
<li><code>.closed</code> — document is closed and must be opened to be used</li>
<li><code>.savingError</code> — document couldn’t be saved (override <code>handleError</code> if you want to know why)</li>
<li><code>.editingDisabled</code> — the document cannot currently be edited (so don’t let your UI do that)</li>
<li><code>.progressAvailable</code> — how far a large document is in getting loaded (check progress var)</li>
<li><code>.inConflict</code> — someone edited this document somewhere else (iCloud)</li>
<li>To resolve conflicts, you access the conflicting versions with <code>NSFileVersion.unresolvedConflictVersionsOfItem(at url: URL) -&gt; [NSFileVersion]?</code>. For the best UI, you could give your user the choice of which version to use. </li>
<li>documentState can be “observed” using the <code>UIDocumentStateChanged</code> notification. </li>
</ol>
<h2 id="Thumbnail"><a href="#Thumbnail" class="headerlink" title="Thumbnail"></a>Thumbnail</h2><ol>
<li>You can specify a thumbnail image for your UIDocument. It can make it much easier for users to find the document they want in Files. </li>
<li>Essentially you are going to override the UIDocument method which sets file attributes. The attributes are returned as a dictionary. </li>
<li>One of the keys is for the thumbnail (it’s a convoluted key)<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">fileAttributesToWrite</span><span class="params">(to url: URL, <span class="keyword">for</span> operation: UIDocumentSaveOperation)</span></span> <span class="keyword">throws</span> -&gt; [<span class="type">AnyHashable</span> : <span class="type">Any</span>] </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">var</span> attributes = <span class="keyword">try</span> <span class="keyword">super</span>.fileAttributesToWrite(to: url, <span class="keyword">for</span>: saveOperation)</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> thumbnail: <span class="type">UIImage</span> = ... </span><br><span class="line">  &#123;</span><br><span class="line">		attributes[<span class="type">URLResourceKey</span>.thumbnailDictionaryKey] =</span><br><span class="line">		[<span class="type">URLThumbnailDictionaryItem</span>.<span class="type">NSThumbnail1024x1024SizeKey</span>:thumbnail]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> attributes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="UIDocumentBrowserViewController"><a href="#UIDocumentBrowserViewController" class="headerlink" title="UIDocumentBrowserViewController"></a>UIDocumentBrowserViewController</h1><ol>
<li>UIDBVC allows users to be able to easily manage documents in a document-based app. Choosing files to open, renaming files, moving them, accessing iCloud drive, etc.</li>
<li>UIDBVC has to be the root view controller in storyboard (i.e. the arrow points to it). </li>
<li>Your document-editing MVC will then be presented modally on top of (i.e. takes over the screen). </li>
<li>To make all this work, you need an entry in your <code>Info.plist</code>. And add <code>Supports Document Browser</code> type of <code>Boolean</code> and value of <code>true</code>. </li>
</ol>
<h2 id="Set-Document-Type-To-Open"><a href="#Set-Document-Type-To-Open" class="headerlink" title="Set Document Type To Open"></a>Set Document Type To Open</h2><ol>
<li>To use the UIDBVC, you have to register which types your application uses. </li>
<li>You do this in the <code>Project Settings</code> in the <code>Info tab</code> with your Target selected. </li>
<li>In the Document Types area, add the types you support. </li>
<li>The Types field is the UTI of the type you want to support (e.g. public.json, public.image).<br><img src="/img/13&amp;14.PersistenceandDocuments01.png" alt="Set type"></li>
</ol>
<h2 id="Declare-Your-Own-Document-Type"><a href="#Declare-Your-Own-Document-Type" class="headerlink" title="Declare Your Own Document Type"></a>Declare Your Own Document Type</h2><ol>
<li>You might have a custom document type that your application edits. </li>
<li>You can add this under Exported UTIs in the same place in Project Settings. </li>
<li>The identifier is the “UTI” that we keep referring to. It’s like public.json is for JSON. </li>
<li>Then add it as a supported Document Type. </li>
<li>In the Additional exported UTI properties, we set <code>public.filename-extension</code> to its extension.<br><img src="/img/13&amp;14.PersistenceandDocuments02.png" alt="Declare Type"></li>
</ol>
<h2 id="Open-Document-at-the-Request-of-Other-Apps"><a href="#Open-Document-at-the-Request-of-Other-Apps" class="headerlink" title="Open Document at the Request of Other Apps"></a>Open Document at the Request of Other Apps</h2><ol>
<li>A user can now click on a document of your type in Files (or another app can ask to open one)</li>
<li>When this happens, your AppDelegate gets a message sent to <code>func application(UIApplication, open: URL, options: [UIApplicationOpenURLOptionsKey:Any]) -&gt; Bool</code></li>
<li>Inside here, you can ask your UIDocumentBrowserViewController to show this document. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> uidbvc = window?.rootViewController <span class="keyword">as</span>? <span class="type">UIDBVC</span> <span class="comment">// since it’s “arrowed” in storyboard </span></span><br><span class="line">uidbvc.revealDocument(at: <span class="type">URL</span>, importIfNeeded: <span class="literal">true</span>) &#123; (url, error) <span class="keyword">in</span></span><br><span class="line">	<span class="keyword">if</span> error != <span class="literal">nil</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// present a UIDocument at url modally (more on how to do this in a moment)</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// handle the error </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Xcode-Template"><a href="#Xcode-Template" class="headerlink" title="Xcode Template"></a>Xcode Template</h2><h3 id="What-New-in-the-Xcode-Template"><a href="#What-New-in-the-Xcode-Template" class="headerlink" title="What New in the Xcode Template"></a>What New in the Xcode Template</h3><ol>
<li>A stub for Document Types in Project Settings (supports public.image file types)</li>
<li>The Info.plist entry <code>Supports Document Browser = YES</code>. </li>
<li>The code in AppDelegate to reveal a document. </li>
<li>A stubbed out UIDocument subclass (with empty contents and load(fromContents) methods) called <code>Document</code></li>
<li>A stubbed out MVC to display a document (just calls UIDocument’s open and close methods) called <code>DocumentViewController</code></li>
<li>A subclass of UIDocumentBrowserViewController (with almost everything implemented) <code>DocumentBrowserViewController</code></li>
</ol>
<h3 id="What-to-Do-to-Use-It"><a href="#What-to-Do-to-Use-It" class="headerlink" title="What to Do to Use It"></a>What to Do to Use It</h3><ol>
<li>Use your UIDocument subclass instead of the stubbed out one. </li>
<li>Use your document-viewing MVC code (already using UIDocument) instead of stub. </li>
<li>Configuring the UIDBVC (allow multiple selection? creation of new documents? etc.) in <code>viewDidLoad</code></li>
<li>Specify the url of a template document to copy to create new documents. Usually you would specify .copy, but you could create a new template each time and .move. Likely you would have some code here that creates that blank template (or ship with your app).</li>
<li>Presenting your document MVC modally. The Xcode template stubs out a function called <code>presentDocument(at: URL)</code> to do this. You can call this function anything you want.<br>But the point is that it takes a URL to one of your documents and you show it.<br>The Xcode template then calls this from the appropriate delegate methods in UIDBVC.</li>
<li>Update the Document Types in Project Settings to be your type. <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .  3</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">	delegate = <span class="keyword">self</span> <span class="comment">// the guts of making UIDBVC work are in its delegate methods </span></span><br><span class="line">  allowsDocumentCreation = <span class="literal">true</span></span><br><span class="line">	allowsPickingMultipleItems = <span class="literal">true</span></span><br><span class="line">	browserUserInterfaceStyle = .dark</span><br><span class="line">	view.tintColor = .white</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 4</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">documentBrowser</span><span class="params">(<span class="number">_</span> controller: UIDBVC, didRequestDocumentCreationWithHandler handler: @escaping <span class="params">(URL?, UIDBVC.ImportMode)</span></span></span> -&gt; <span class="type">Void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> url: <span class="type">URL?</span> = …</span><br><span class="line">	importHandler(url, .copy or .move) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// . 5</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">presentDocument</span><span class="params">(at url: URL)</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">let</span> story = <span class="type">UIStoryboard</span>(name: “<span class="type">Main</span>”, bundle: <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">let</span> docvc = story.instantiateViewController(withIdentifier: “<span class="type">DocVC</span>”) <span class="keyword">as</span>? <span class="type">DocVC</span></span><br><span class="line">  &#123;</span><br><span class="line">		docvc.document = <span class="type">MyDocument</span>(fileURL: url)</span><br><span class="line">		present(docvc, animated: <span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Aside-Present-An-MVC-Without-Segue"><a href="#Aside-Present-An-MVC-Without-Segue" class="headerlink" title="Aside: Present An MVC Without Segue"></a>Aside: Present An MVC Without Segue</h3><ol>
<li>You present a new MVC from an existing MVC using <code>present(animated:)</code>.</li>
<li>You get new MVC from your storyboard using its identifier which you set in Identity Inspector . <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> storyboard = <span class="type">UIStoryboard</span>(name: “<span class="type">Main</span>”, bundle: <span class="literal">nil</span>) <span class="comment">// Main.storyboard</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> newVC = storyboard.instantiateViewController(withIdentifier: “<span class="type">MyVC</span>”) <span class="keyword">as</span>? <span class="type">MyVC</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// “prepare” newMVC and then present(animated:) it</span></span><br><span class="line">  existingVC.present(newVC, animated: <span class="literal">true</span>)</span><br><span class="line">  &#123;</span><br><span class="line">		<span class="comment">// completion handler called when the presentation completes animating</span></span><br><span class="line">		<span class="comment">// (can be left out entirely if you don’t need to do anything upon completion)</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/" rel="tag"><i class="fa fa-tag"></i> 应用开发</a>
              <a href="/tags/Swift/" rel="tag"><i class="fa fa-tag"></i> Swift</a>
              <a href="/tags/iOS/" rel="tag"><i class="fa fa-tag"></i> iOS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/08/17/11&12-Drag-and-Drop-Table-View-and-Collection-View/" rel="prev" title="11&12. Drag and Drop, Table View, and Collection View, and Text Field">
      <i class="fa fa-chevron-left"></i> 11&12. Drag and Drop, Table View, and Collection View, and Text Field
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/08/24/15-Alert-Notification-Application-Lifecycle/" rel="next" title="15. Alert, Notification, Application Lifecycle">
      15. Alert, Notification, Application Lifecycle <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#UserDefaults"><span class="nav-number">1.</span> <span class="nav-text">UserDefaults</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Archiving"><span class="nav-number">2.</span> <span class="nav-text">Archiving</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NSCoder-Old-Mechanism"><span class="nav-number">2.1.</span> <span class="nav-text">NSCoder (Old Mechanism)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Codable-New-Mechanism"><span class="nav-number">2.2.</span> <span class="nav-text">Codable (New Mechanism)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#File-System"><span class="nav-number">3.</span> <span class="nav-text">File System</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Core-Data"><span class="nav-number">4.</span> <span class="nav-text">Core Data</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cloud-Kit"><span class="nav-number">5.</span> <span class="nav-text">Cloud Kit</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UIDocument"><span class="nav-number">6.</span> <span class="nav-text">UIDocument</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic"><span class="nav-number">6.1.</span> <span class="nav-text">Basic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-A-UIDocument"><span class="nav-number">6.2.</span> <span class="nav-text">Create A UIDocument</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Convert-between-Model-and-Data"><span class="nav-number">6.3.</span> <span class="nav-text">Convert between Model and Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Open-and-Close"><span class="nav-number">6.4.</span> <span class="nav-text">Open and Close</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Save"><span class="nav-number">6.5.</span> <span class="nav-text">Save</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Document-State"><span class="nav-number">6.6.</span> <span class="nav-text">Document State</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thumbnail"><span class="nav-number">6.7.</span> <span class="nav-text">Thumbnail</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UIDocumentBrowserViewController"><span class="nav-number">7.</span> <span class="nav-text">UIDocumentBrowserViewController</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Set-Document-Type-To-Open"><span class="nav-number">7.1.</span> <span class="nav-text">Set Document Type To Open</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Declare-Your-Own-Document-Type"><span class="nav-number">7.2.</span> <span class="nav-text">Declare Your Own Document Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Open-Document-at-the-Request-of-Other-Apps"><span class="nav-number">7.3.</span> <span class="nav-text">Open Document at the Request of Other Apps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Xcode-Template"><span class="nav-number">7.4.</span> <span class="nav-text">Xcode Template</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-New-in-the-Xcode-Template"><span class="nav-number">7.4.1.</span> <span class="nav-text">What New in the Xcode Template</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-to-Do-to-Use-It"><span class="nav-number">7.4.2.</span> <span class="nav-text">What to Do to Use It</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Aside-Present-An-MVC-Without-Segue"><span class="nav-number">7.4.3.</span> <span class="nav-text">Aside: Present An MVC Without Segue</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LiyunZhang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">LiyunZhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">184</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liyun Zhang</span>
</div>
<div class="BbeiAn-info">
       浙ICP备 -
    <a target="_blank" href="http://www.miitbeian.gov.cn/" style="color:#000000"  rel="nofollow">19047088号-1</a> <!--a标签中增加nofollow属性，避免爬虫出站。-->|
    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011802001835" style="color:#000000;text-decoration:none;padding-left:30px;background:url(https://s1.ax1x.com/2018/09/29/ilmwIH.png) no-repeat left center" rel="nofollow">浙公网安备 33011802001835号</a>      <!--这里将图标作为了背景，以使得能和后面的文字在同一行-->

</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
